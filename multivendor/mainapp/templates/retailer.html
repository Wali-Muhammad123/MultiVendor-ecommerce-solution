{% extends 'base.html' %}
{% load static %}
{% load bootstrap5 %}
{% block title %} Retailer {% endblock %}
{% block content %}

<body>
    <nav class="navbar navbar-dark navbar-expand-md bg-dark py-3">
        <div class="container"><a class="navbar-brand d-flex align-items-center" href="#"><span class="bs-icon-sm bs-icon-rounded bs-icon-primary d-flex justify-content-center align-items-center me-2 bs-icon"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-bezier">
                        <path fill-rule="evenodd" d="M0 10.5A1.5 1.5 0 0 1 1.5 9h1A1.5 1.5 0 0 1 4 10.5v1A1.5 1.5 0 0 1 2.5 13h-1A1.5 1.5 0 0 1 0 11.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zm10.5.5A1.5 1.5 0 0 1 13.5 9h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM6 4.5A1.5 1.5 0 0 1 7.5 3h1A1.5 1.5 0 0 1 10 4.5v1A1.5 1.5 0 0 1 8.5 7h-1A1.5 1.5 0 0 1 6 5.5v-1zM7.5 4a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1z"></path>
                        <path d="M6 4.5H1.866a1 1 0 1 0 0 1h2.668A6.517 6.517 0 0 0 1.814 9H2.5c.123 0 .244.015.358.043a5.517 5.517 0 0 1 3.185-3.185A1.503 1.503 0 0 1 6 5.5v-1zm3.957 1.358A1.5 1.5 0 0 0 10 5.5v-1h4.134a1 1 0 1 1 0 1h-2.668a6.517 6.517 0 0 1 2.72 3.5H13.5c-.123 0-.243.015-.358.043a5.517 5.517 0 0 0-3.185-3.185z"></path>
                    </svg></span><span>DarkWolf</span></a><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-5"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navcol-5">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="#">Your Cart</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Promotions</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Become a Retailer</a></li>
                </ul><a class="btn btn-primary ms-md-2" role="button" href="{% url 'mainapp:logout' %}">Sign Out</a>
            </div>
        </div>
    </nav>
    <section class="py-4 py-xl-5">
        <div class="container">
            <div class="text-white bg-dark border rounded border-0 p-4 p-md-5">
                <h2 class="fw-bold text-white mb-3">Hello, {{ retailer.name }}.</h2>
                <p class="mb-4">Have a look at your inventory, and increase it. Have a look at your sales metric and gain a clear understanding of where the business is going.&nbsp;</p>
                <div class="my-3"><a class="btn btn-primary btn-lg me-2" role="button" href="#">Generate Report&nbsp;</a><a class="btn btn-light btn-lg" role="button" href="#">Report an issue</a></div>
            </div>
        </div>
    </section>
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="text-center card-title">Profit made till this date</h4><span style="font-size: 64px;text-align: center;margin-left: 125px;color: var(--bs-gray-800);">{{ total_profit }}$</span>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title" style="text-align: center;">Total items in inventory</h4><span style="font-size: 64px;margin-left: 154px;color: var(--bs-gray-800);">{{ total_inventory }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <section class="py-4 py-xl-5">
        <div class="container">
            <div class="bg-light border rounded border-0 border-light d-flex flex-column justify-content-between flex-lg-row p-4 p-md-5">
                <div class="pb-2 pb-lg-1">
                    <h2 class="fw-bold mb-2">Detailed Summary of your sales</h2>
                    <p class="mb-0">Manage your products, see the sales all in one table.</p>
                </div>
                <div class="my-2"></div>
            </div>
        </div>
        <section style="margin-left: 53px;border: 1px solid var(--bs-gray);width: 863px;height: 132px;margin-top: 8px;">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Category&nbsp;</th>
                            <th>Purchased Amount</th>
                            <th>Purchased Qty&nbsp;</th>
                            <th>Sold Amount</th>
                            <th>Sold Qty</th>
                            <th>Profit</th>
                            <th>In Stock</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in inventory %}
                        <tr>
                            <td>{i.name}</td>
                            <td>{i.category}</td>
                            <td>{i.purchased_amount}</td>
                            <td>{ i.quantity_bought}</td>
                            <td>{i.sales}</td>
                            <td>{i.quantity_sold}</td>
                            <td>{i.profit}</td>
                            <td>{i.stock}</td>
                        </tr>
                        {% endfor %}
                        <tr>
                            <td style="font-weight: bold;">Total&nbsp;</td>
                            <td></td>
                            <td style="font-weight: bold;">{{ total_purchase_amount }}</td>
                            <td style="font-weight: bold;">{{ total_purchased_quanity }}</td>
                            <td style="font-weight: bold;">{{ total_sales_amount }}</td>
                            <td style="font-weight: bold;">{{ total_sales_volume }}</td>
                            <td style="font-weight: bold;">{{ total_profit }}</td>
                            <td style="font-weight: bold;">{{ in_stock }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </section>
    <section class="py-4 py-xl-5" style="margin-top: -27px;">
        <div class="container">
            <div class="bg-light border rounded border-0 border-light d-flex flex-column justify-content-between flex-lg-row p-4 p-md-5" style="height: 165.141px;">
                <div class="pb-2 pb-lg-1">
                    <h2 class="fw-bold mb-2">Inventory Management</h2>
                    <p class="mb-0">Add a product to your inventory, delete an item, increase the quantity of a particular item, or increase the price of an existing item.</p>
                </div>
                <div class="my-2"></div>
            </div>
        </div>
    </section>
    <section style="margin-left: 59px;">
        <div>
            <ul class="nav nav-tabs nav-justified" role="tablist">
                <li class="nav-item" role="presentation"><a class="nav-link" role="tab" data-bs-toggle="tab" href="#tab-1">Add a New Product</a></li>
                <li class="nav-item" role="presentation"><a class="nav-link active" role="tab" data-bs-toggle="tab" href="#tab-2">Update an existing product</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane" role="tabpanel" id="tab-1">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Details of New Product</h4>
                            <h6 class="text-muted card-subtitle mb-2">Enter the details of the new product and we will ship it to right away for you.</h6>
                            <form id="add_product_form" method="post" action="">
                                {% csrf_token %}
                                {{ form.as_p }}
                                <div id="x"><button class="btn btn-primary" type="submit" style="margin-top: 25px;">Add to inventory</button></div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="tab-pane active" role="tabpanel" id="tab-2">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">Update Inventory&nbsp;</h4>
                            <h6 class="text-muted card-subtitle mb-2">Update your inventory. Change a product's name, price, or quantity, or just simply delete that product from the list.&nbsp;</h6>
                            <div style="margin-top: 23px;">
                                <div class="d-flex justify-content-center h-100" style="width: 547px;">
                                    <div class="searchbar"><input type="text" class="search_input" placeholder="Enter Product ID" id="user-input"><a class="search_icon" href="#"><i class="fas fa-search"></i></a></div>
                                </div>
                            </div>
                            <div style="margin-top: 26px;">
                                <form id="update">
                                    {% csrf_token %}
                                    <div style="display: flex;margin-top: 15px;"><label class="form-label" style="font-weight: bold;text-align: left;font-family: Poppins, sans-serif;">Name</label><input class="form-control" type="text" style="margin-left: 89px;width: 505.734px;" id="_name"></div>
                                    <div style="display: flex;margin-top: 15px;"><label class="form-label" style="font-weight: bold;font-family: Poppins, sans-serif;">Product Price</label><input class="form-control" type="number" style="width: 480.594px;margin-left: 33px;" id="_tel"></div>
                                    <div style="display: flex;margin: 16px 0px 0px;margin-top: 16px;"><label class="form-label" style="font-weight: bold;font-family: Poppins, sans-serif;">Product Description&nbsp;</label><input class="form-control" type="text" style="margin-left: 3px;" id="_desc"></div>
                                    <div style="display: flex;margin-top: 15px;"><label class="form-label" style="font-weight: bold;font-family: Poppins, sans-serif;">Quantity</label><input class="form-control" type="number" style="width: 680.219px;margin-left: 71px;" id="_quantity"></div>
                                    <div style="display: flex;margin-top: 16px;"><label class="form-label" style="font-weight: bold;font-family: Poppins, sans-serif;">Category&nbsp;</label><select class="form-select" style="margin-left: 62px;width: 491.781px;" id="_category">
                                            <option value="0" selected="">Choose a Category</option>
                                            <option value="Electronics">Electronics</option>
                                            <option value="Clothing">Clothing</option>
                                            <option value="Footwear">Footwear</option>
                                            <option value="Home Appliances">Home Appliances</option>
                                            <option value="Mobiles ">Mobiles </option>
                                            <option value="Groceries">Groceries</option>
                                        </select></div>
                                    <div style="display: flex;"><button class="btn btn-primary" type="submit" style="margin-top: 25px;">Update in inventory</button><button class="btn btn-primary" type="button" style="margin-left: 26px;margin-top: 24px;">Delete from the inventory</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script src="/static/js/jquery.min.js"></script>
    <script>
        $(document).ready(function(){

        })
    </script>
    <script>
        $(document).ready(function(){
    
            $('#add_product_form').on('submit', function(e){
                e.preventDefault();
                var name=$('#name').val();
                var price=$('#price').val();
                var category=$('#category').val();
                var product_description=$('#desc').val();
                var quantity=$('#quantity').val();
                if (category == "0"){
                    $('#x').append(
                        <div>
                            <p> Please choose a category of the product </p>
                            </div>
                    );
                }
                else {
                    $.ajax({
                        url: "{% url 'mainapp:retailer' %}",
                        type: "POST",
                        data: {
                            'name': name,
                            'price': price,
                            'category': category,
                            'product_description': product_description,
                            'quantity': quantity,
                            'csrfmiddlewaretoken': '{{ csrf_token }}'
                        },
                        success: function (response) {
                            console.log(response);
                            if (response == "success") {
                                alert("Product added successfully");
                            }
                            else {
                                alert("Product not added");
                            }
                        }
                    });
                }
    
            });
            $('#update').on('submit', function(e){
                e.preventDefault();
                var name=$('#_name').val();
                var price=$('#_tel').val();
                var category=$('#_category').val();
                var product_description=$('#_desc').val();
                var quantity=$('#_quantity').val();
                if (category == "0"){
                    $('#x').append(
                        <div>
                            <p> Please choose a category of the product </p>
                            </div>
                    );
                }
                else if (name == "" || price == "" || product_description == "" || quantity == "") {
                    $('#x').append(
                        <div>
                            <p> Please select a product which is needed to be updated from the search bar.</p>
                            </div>
                    );
                }
                else {
                    $.ajax({
                        url: "{% url 'mainapp:retailer' %}",
                        type: "PUT",
                        data: {
                            'name': name,
                            'price': price,
                            'category': category,
                            'product_description': product_description,
                            'quantity': quantity,
                            'csrfmiddlewaretoken': '{{ csrf_token }}'
                        },
                        success: function (response) {
                            console.log(response);
                            if (response == "success") {
                                alert("Product added successfully");
                            }
                            else {
                                alert("Product not added");
                            }
                        }
                    });
                }
            });
        });
        $('#user-input').on('keyup', function(){
            var search = $(this).val().lower();
            var productID=[]
            for (var i of {inventory}){
                productID.push(i.product_id.lower());
            }
            if (search.length>0){
                var filtered = productID.filter(function (item) {
                    return item.indexOf(search.toLowerCase()) > -1;
                });
                for (var k of filtered){
                    $(this).append(
                        <div>
                            <p class="searchresult"> {{k}} </p>
                        </div>
                    );
                }
            
            }
        });
    $('.searchresult').onclick(function(e){
        var product_id = $(this).text();
        var product = {inventory}.filter(function (item) {
                    return item.product_id.lower() == product_id;
                });
        $('#_name').val(product[0].product_name);
        $('#_tel').val(product[0].product_price);
        $('#_desc').val(product[0].product_description);
        $('#_quantity').val(product[0].quantity);
        $('#_category').val(product[0].category);
    
    });
    </script>
    {% include 'footer.html' %}
    {% endblock %}
